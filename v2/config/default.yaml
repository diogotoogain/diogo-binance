# ═══════════════════════════════════════════════════════════════
# V2 CONFIGURATION - ALL PARAMETERS FROM CONFIG, NO HARDCODED VALUES
# ═══════════════════════════════════════════════════════════════

# ═══════════════════════════════════════════════════════════════
# MARKET
# ═══════════════════════════════════════════════════════════════
market:
  exchange: "binance_testnet"
  symbol: "BTCUSDT"
  base_timeframes: ["1s", "1m", "5m", "15m", "1h"]

# ═══════════════════════════════════════════════════════════════
# BAR CONSTRUCTION
# ═══════════════════════════════════════════════════════════════
bar_construction:
  type: "time"  # TOGGLE: [time, volume, dollar]
  volume_bar_threshold: 100
  dollar_bar_threshold: 10000000

# ═══════════════════════════════════════════════════════════════
# FEATURES - ALL PARAMETERS OPTIMIZABLE
# ═══════════════════════════════════════════════════════════════
features:
  microstructure:
    enabled: true
    ofi:
      enabled: true
      window: 20  # OPTIMIZE: [5, 10, 20, 50, 100]
    tfi:
      enabled: true
      window: 20  # OPTIMIZE: [5, 10, 20, 50, 100]
    micro_price:
      enabled: true
    entropy:
      enabled: true
      window: 50  # OPTIMIZE: [20, 50, 100]
    vpin:
      enabled: true
      n_buckets: 50  # OPTIMIZE: [20, 50, 100]

  technical:
    enabled: true
    ema:
      periods: [9, 21, 50, 100, 200]
    rsi:
      enabled: true
      period: 14  # OPTIMIZE: [7, 14, 21]
      overbought: 70  # OPTIMIZE: [65, 70, 75, 80]
      oversold: 30  # OPTIMIZE: [20, 25, 30, 35]
    macd:
      enabled: true
      fast: 12  # OPTIMIZE: [8, 12, 16]
      slow: 26  # OPTIMIZE: [20, 26, 32]
      signal: 9  # OPTIMIZE: [6, 9, 12]
    adx:
      enabled: true
      period: 14  # OPTIMIZE: [10, 14, 20]
    bollinger:
      enabled: true
      period: 20  # OPTIMIZE: [10, 20, 30]
      std_dev: 2.0  # OPTIMIZE: [1.5, 2.0, 2.5, 3.0]
    atr:
      enabled: true
      period: 14  # OPTIMIZE: [7, 14, 21]

  volume_analysis:
    enabled: true
    volume_spike:
      enabled: true
      lookback: 20  # OPTIMIZE: [10, 20, 30]
      threshold_multiplier: 2.0  # OPTIMIZE: [1.5, 2.0, 2.5, 3.0]
    liquidity_clusters:
      enabled: true
      levels: 10  # OPTIMIZE: [5, 10, 20]
      threshold_percentile: 80  # OPTIMIZE: [70, 80, 90]

# ═══════════════════════════════════════════════════════════════
# REGIME DETECTION
# ═══════════════════════════════════════════════════════════════
regime_detection:
  enabled: true
  hmm:
    enabled: true
    n_regimes: 3  # OPTIMIZE: [2, 3, 4]
    features_for_hmm: ["returns", "volatility", "volume"]
  adx_regime:
    enabled: true
    trending_threshold: 25  # OPTIMIZE: [20, 25, 30]
    ranging_threshold: 20  # OPTIMIZE: [15, 20, 25]

# ═══════════════════════════════════════════════════════════════
# LABELING
# ═══════════════════════════════════════════════════════════════
labeling:
  triple_barrier:
    enabled: true
    tp_multiplier: 2.0  # OPTIMIZE: [1.5, 2.0, 2.5, 3.0]
    sl_multiplier: 1.0  # OPTIMIZE: [0.5, 1.0, 1.5, 2.0]
    max_holding_bars: 100  # OPTIMIZE: [50, 100, 200]
  meta_labeling:
    enabled: true
    model_type: "xgboost"  # TOGGLE: [xgboost, lightgbm, random_forest]
    confidence_threshold: 0.6  # OPTIMIZE: [0.5, 0.6, 0.7]

# ═══════════════════════════════════════════════════════════════
# STRATEGIES
# ═══════════════════════════════════════════════════════════════
strategies:
  hft_ofi_scalper:
    enabled: true
    params:
      ofi_threshold: 0.3  # OPTIMIZE: [0.1, 0.2, 0.3, 0.4, 0.5]
      tfi_threshold: 0.3  # OPTIMIZE: [0.1, 0.2, 0.3, 0.4, 0.5]
      min_spread_bps: 1.0  # OPTIMIZE: [0.5, 1.0, 2.0]
      holding_seconds: 30  # OPTIMIZE: [10, 30, 60]
    filters:
      adx_filter:
        enabled: true
        max_adx: 30  # OPTIMIZE: [25, 30, 35]
      volume_spike_filter:
        enabled: true
        min_spike_multiplier: 1.5  # OPTIMIZE: [1.2, 1.5, 2.0]
    throttling:
      enabled: true
      max_trades_per_minute: 5  # OPTIMIZE: [3, 5, 10]
      cooldown_after_loss_seconds: 30  # OPTIMIZE: [15, 30, 60]

  momentum_intraday:
    enabled: true
    params:
      ema_fast: 9  # OPTIMIZE: [5, 9, 12]
      ema_slow: 21  # OPTIMIZE: [15, 21, 30]
      rsi_entry_threshold: 50  # OPTIMIZE: [45, 50, 55]
      holding_minutes: 60  # OPTIMIZE: [30, 60, 120]
    filters:
      adx_filter:
        enabled: true
        min_adx: 25  # OPTIMIZE: [20, 25, 30]
      volume_confirmation:
        enabled: true
        min_volume_percentile: 60  # OPTIMIZE: [50, 60, 70]
    throttling:
      enabled: true
      max_trades_per_hour: 4  # OPTIMIZE: [2, 4, 8]

  mean_reversion_intraday:
    enabled: true
    params:
      zscore_entry: 2.0  # OPTIMIZE: [1.5, 2.0, 2.5]
      zscore_exit: 0.5  # OPTIMIZE: [0.25, 0.5, 0.75]
      bollinger_entry_std: 2.0  # OPTIMIZE: [1.5, 2.0, 2.5]
      holding_minutes: 30  # OPTIMIZE: [15, 30, 60]
    filters:
      adx_filter:
        enabled: true
        max_adx: 20  # OPTIMIZE: [15, 20, 25]
      liquidity_cluster_filter:
        enabled: true
        proximity_threshold_pct: 0.5  # OPTIMIZE: [0.25, 0.5, 1.0]
    throttling:
      enabled: true
      max_trades_per_hour: 6  # OPTIMIZE: [4, 6, 10]

  volatility_breakout:
    enabled: true
    params:
      squeeze_bb_width_percentile: 20  # OPTIMIZE: [10, 20, 30]
      breakout_atr_multiplier: 1.5  # OPTIMIZE: [1.0, 1.5, 2.0]
      volume_confirmation_mult: 1.5  # OPTIMIZE: [1.2, 1.5, 2.0]
      holding_minutes: 120  # OPTIMIZE: [60, 120, 240]
    filters:
      adx_filter:
        enabled: true
        min_adx_after_breakout: 20  # OPTIMIZE: [15, 20, 25]
    throttling:
      enabled: true
      max_trades_per_day: 3  # OPTIMIZE: [2, 3, 5]

# ═══════════════════════════════════════════════════════════════
# ENSEMBLE
# ═══════════════════════════════════════════════════════════════
ensemble:
  weighting_method: "sharpe"  # TOGGLE: [sharpe, equal, inverse_vol]
  lookback_days: 30  # OPTIMIZE: [14, 30, 60]
  min_confidence: 0.5  # OPTIMIZE: [0.4, 0.5, 0.6]
  rebalance_frequency_hours: 24  # OPTIMIZE: [6, 12, 24, 48]
  strategy_constraints:
    max_weight_per_strategy: 0.6  # OPTIMIZE: [0.4, 0.6, 0.8]
    min_weight_per_strategy: 0.0
  disable_strategy_if:
    max_drawdown_pct: 15.0  # OPTIMIZE: [10, 15, 20]
    min_sharpe: 0.5  # OPTIMIZE: [0.3, 0.5, 0.7]
  meta_labeling_filter:
    enabled: true
    min_meta_confidence: 0.6  # OPTIMIZE: [0.5, 0.6, 0.7]

# ═══════════════════════════════════════════════════════════════
# RISK MANAGEMENT
# ═══════════════════════════════════════════════════════════════
risk:
  max_risk_per_trade_pct: 0.5  # OPTIMIZE: [0.25, 0.5, 1.0]
  max_daily_loss_pct: 3.0  # OPTIMIZE: [2.0, 3.0, 5.0]
  max_weekly_loss_pct: 7.0  # OPTIMIZE: [5.0, 7.0, 10.0]
  max_monthly_loss_pct: 15.0  # OPTIMIZE: [10.0, 15.0, 20.0]
  max_drawdown_pct: 20.0  # OPTIMIZE: [15.0, 20.0, 25.0]
  max_open_positions: 1  # OPTIMIZE: [1, 2, 3]
  max_leverage: 10  # OPTIMIZE: [5, 10, 20]
  regime_risk_adjustment:
    enabled: true
    crash_regime_multiplier: 0.3  # OPTIMIZE: [0.1, 0.3, 0.5]
    high_vol_regime_multiplier: 0.5  # OPTIMIZE: [0.3, 0.5, 0.7]
  kill_switch:
    enabled: true  # MUST ALWAYS BE TRUE
    max_loss_trigger_pct: 5.0  # OPTIMIZE: [3.0, 5.0, 7.0]
    pause_duration_hours: 24  # OPTIMIZE: [12, 24, 48]

# ═══════════════════════════════════════════════════════════════
# BET SIZING
# ═══════════════════════════════════════════════════════════════
bet_sizing:
  method: "kelly"  # TOGGLE: [kelly, vol_target, fixed, rl_dynamic]
  kelly:
    fraction: 0.25  # OPTIMIZE: [0.1, 0.25, 0.5]
    max_bet_pct: 0.1  # OPTIMIZE: [0.05, 0.1, 0.2]
  vol_target:
    target_annual_vol: 0.15  # OPTIMIZE: [0.1, 0.15, 0.2]
  fixed:
    position_size_pct: 0.02  # OPTIMIZE: [0.01, 0.02, 0.05]
  rl_dynamic:
    enabled: false
    model_path: "models/rl/bet_sizing_model.zip"

# ═══════════════════════════════════════════════════════════════
# REINFORCEMENT LEARNING
# ═══════════════════════════════════════════════════════════════
rl:
  enabled: true
  train_on_colab: true
  environment:
    observation_features: ["ofi", "tfi", "rsi", "adx", "regime", "position", "pnl", "drawdown"]
    action_space:
      direction: [-1, 0, 1]  # Short, Hold, Long
      position_size: [0.0, 0.25, 0.5, 0.75, 1.0]
      sl_atr_mult: [0.5, 1.0, 1.5, 2.0, 3.0]
      tp_atr_mult: [1.0, 1.5, 2.0, 3.0, 5.0]
    reward_function: "sharpe"  # TOGGLE: [pnl, sharpe, sortino, calmar]
    episode_length: 1440  # 1 day in minutes
    initial_balance: 10000
  agents:
    ppo:
      enabled: true
      learning_rate: 0.0003  # OPTIMIZE: [0.0001, 0.0003, 0.001]
      n_steps: 2048  # OPTIMIZE: [1024, 2048, 4096]
      batch_size: 64  # OPTIMIZE: [32, 64, 128]
      n_epochs: 10  # OPTIMIZE: [5, 10, 20]
      gamma: 0.99  # OPTIMIZE: [0.95, 0.99, 0.999]
      gae_lambda: 0.95  # OPTIMIZE: [0.9, 0.95, 0.99]
      clip_range: 0.2  # OPTIMIZE: [0.1, 0.2, 0.3]
    sac:
      enabled: true
      learning_rate: 0.0003  # OPTIMIZE: [0.0001, 0.0003, 0.001]
      buffer_size: 1000000  # OPTIMIZE: [100000, 1000000]
      learning_starts: 100  # OPTIMIZE: [50, 100, 200]
      batch_size: 256  # OPTIMIZE: [128, 256, 512]
      tau: 0.005  # OPTIMIZE: [0.001, 0.005, 0.01]
      gamma: 0.99  # OPTIMIZE: [0.95, 0.99, 0.999]
  training:
    total_timesteps: 100000  # OPTIMIZE: [50000, 100000, 500000]
    eval_freq: 10000
    n_eval_episodes: 5
    save_freq: 10000

# ═══════════════════════════════════════════════════════════════
# ONLINE LEARNING
# ═══════════════════════════════════════════════════════════════
online_learning:
  enabled: true
  river_models:
    enabled: true
    model_type: "HoeffdingTree"  # TOGGLE: [HoeffdingTree, AdaptiveRandomForest]
  drift_detection:
    enabled: true
    method: "ADWIN"  # TOGGLE: [ADWIN, DDM, EDDM]
    delta: 0.002  # OPTIMIZE: [0.001, 0.002, 0.005]
    retrain_on_drift: true

# ═══════════════════════════════════════════════════════════════
# OPTIMIZATION (Optuna)
# ═══════════════════════════════════════════════════════════════
optimization:
  n_trials: 1000  # OPTIMIZE: [500, 1000, 2000]
  n_jobs: -1  # -1 = use all cores
  study_name: "btcusdt_v2"
  storage_type: "sqlite"  # TOGGLE: [sqlite, postgresql]
  objectives:
    primary: "sharpe"  # TOGGLE: [sharpe, sortino, calmar, profit_factor]
    secondary: "max_drawdown"
  pruning:
    enabled: true
    min_trials: 50
    patience: 20
  feature_selection:
    enabled: true
    method: "optuna"  # TOGGLE: [optuna, shap, mutual_info]
  strategy_selection:
    enabled: true
    method: "optuna"
  sampler:
    type: "TPE"  # TOGGLE: [TPE, CMA-ES, Random]
    multivariate: true
    n_startup_trials: 10

# ═══════════════════════════════════════════════════════════════
# BACKTEST
# ═══════════════════════════════════════════════════════════════
backtest:
  initial_capital: 10000
  slippage:
    type: "volume_based"  # TOGGLE: [fixed, volume_based]
    base_bps: 1.0  # OPTIMIZE: [0.5, 1.0, 2.0]
    volume_impact: 0.5  # OPTIMIZE: [0.3, 0.5, 1.0]
    spread_factor: 1.0  # OPTIMIZE: [0.5, 1.0, 1.5]
  fees:
    taker: 0.0004
    maker: 0.0002
    funding_rate: 0.0001
  walk_forward:
    enabled: true
    train_days: 60  # OPTIMIZE: [30, 60, 90]
    test_days: 14  # OPTIMIZE: [7, 14, 21]
    step_days: 7  # OPTIMIZE: [3, 7, 14]
  monte_carlo:
    enabled: true
    n_simulations: 1000
    confidence_level: 0.95

# ═══════════════════════════════════════════════════════════════
# MODEL VERSIONING
# ═══════════════════════════════════════════════════════════════
model_versioning:
  enabled: true
  max_models_per_strategy: 5
  naming_convention: "{strategy}_{date}_{version}.pkl"
  rollback:
    enabled: true
    rollback_if_worse_by_pct: 10
    comparison_metric: "sharpe"
    comparison_window_days: 7

# ═══════════════════════════════════════════════════════════════
# LOGGING
# ═══════════════════════════════════════════════════════════════
logging:
  level: "INFO"  # TOGGLE: [DEBUG, INFO, WARNING, ERROR]
  format: "parquet"  # TOGGLE: [parquet, csv, json]
  compression: "snappy"
  partition_by: "date"
  store:
    features: true
    predictions: true
    trades: true
    pnl_by_strategy: true
    regime: true
  retention_days: 90

# ═══════════════════════════════════════════════════════════════
# LEARNING / RETRAINING
# ═══════════════════════════════════════════════════════════════
learning:
  retrain_frequency_hours: 24
  training_window_days: 60
  validation_split: 0.2
  early_stopping_patience: 10
  min_samples_for_training: 1000
